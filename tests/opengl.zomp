/**
Demonstrates using OpenGL.

Enter this into toplevel to load libs:
x!load libglfw.dylib

You will need to copy the file libglfw.dylib from the lib/macosx dir
of GLFW 2.6 into the zomp main dir

Conventions for function names:
  send* - sending vertex data (to be included in glbegin/end)
  render* - send geometry (outside of glBegin/glEnd)
  draw* - setup material and render
*/

(include "opengl20.zomp")
(include "glfw.zomp")

(include "tests/glutils.zomp")

(const int windowWidth 400)
(const int windowHeight 300)

(func int main () (
  (if (int.notEqual (glfwInit) GL_TRUE) (
    (printlnString "glfw initialization failed")
    (ret 1))
    ())

  (glfwOpenWindow windowWidth windowHeight 8 8 8 8 16 0 GLFW_WINDOW)

  (var bool abort false)
  
  (while (bool.not abort) (
    (if (int.equal (glfwGetKey GLFW_KEY_ESC) GL_TRUE) (
      (assign abort true)
      )())
  
    (glClearColor 1. 0. 0. 1.)
    (glClear (int.or GL_COLOR_BUFFER_BIT GL_DEPTH_BUFFER_BIT))
    (glfwSwapBuffers)
    (glfwPollEvents)
    ))

  (ret 0)
  ))

(testf (
  (zompLoadLib "libglfw.dylib")
  (zompLoadLib "libGLEW.dylib")
  
  (const int retval (main))
  (printString "Main returned ")
  (printInt retval)
  (println)
  ))


