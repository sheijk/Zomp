/**
 * Minimalistic test for interactive toplevel integration in emacs
 */

(func int main () (
  (printlnInt 1000)
  (ret 104)
  ))

(macro twice code (
  (code)
  (code)
  ))

// (#var int lastId 0)
// (func int uniqueId () (
//   (assign lastId (int.add lastId 1))
//   (ret lastId)
//   ))
  
(macro for index min max code (
  #(var cstring startLabel (uniqueId))
  (var int index min)
  (label start)
  (var bool t (int.uless index max))
  (branch t goon end)
  (label goon)
  code
  (assign index (int.add index 1))
  (branch start)
  (label end)
  ))

(func void printChars ((char c) (int count)) (
  (for i 0 count
    (printChar c) )
  ))
  
(func void test () (
  (println)
  (printChars '-' 40) (println)
  (printString "Calling main()... \n")
  (var int retval (main))
  (printString "Returned: ")
  (printInt retval)
  (println)
  (twice (printString "=x=- "))
  (println)
  (for i 10 20 ((printString "index = ") (printlnInt i)))
  (println)
  ))
  
